//-------------------------------------------------------------------------------
define(["text!./modal.html", "css!./modal.css"], function(tpl){
//-------------------------------------------------------------------------------
	var template = $.templates(tpl),
		zIndex = 1000000;

	return {
		open: open
	};
	//-------------------------------------------------------------------------------
	function open(content){
	//-------------------------------------------------------------------------------
		var $modal = $(template.render({ content: content, zIndex: zIndex++ }))
				.appendTo($("body").addClass("has-modals"))
				.on("click", ".close", close);

		$modal.close = close;

		window.setTimeout($("").addClass.bind($modal, "visible"), 100);

		return $modal;
		//-------------------------------------------------------------------------------
		function close(){
		//-------------------------------------------------------------------------------
			if($("body").children(".modal").length == 1)
				$("body").removeClass("has-modals");

			$modal.removeClass("visible");
			window.setTimeout(function(){
				$modal.remove();
			}, 500);
		}
		//-------------------------------------------------------------------------------
	}
	//-------------------------------------------------------------------------------
});
//-------------------------------------------------------------------------------
